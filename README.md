# Chanitor-Malware
Analysing the Chanitor maldoc and intial dll files. We extract the dll from the maldoc, then move on to extract the secondary dll payload embedded in the first dll. 

Working on the doc file with Hash 3ea4c3beeafcac7d68431d3b7a5d2e90d88f98d76ded152a88d60a85d8906105
![h1](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/2ec2a615-d6ae-43b0-8a84-a3e878ad6766)

The file is having 45 detection on VT out of 62
 
Dumping this file in oledump folder and will Run some command 

olevba Homelander.doc > C:\Users\vboxuser\Desktop\InitialMacro.js
To Extract and dump the Macro
![h1 1](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/3b0e6e70-f84e-4907-a817-839d0156f1e6)

The ShellExecuteA function in VBA is being used to execute the commands.
 In this case, it's being used to execute a command stored in the gc function.

The code checks if a file named "kikus.dll" exists in a specific directory (vcbc). If the file does not exist, it proceeds to call the 'yyy' and 'hdhdd' subroutines.

The concatenation of strings to form the rundll32 command (bbbb & cvzz) here is used in a malicious way.
The rundll32 utility in Windows is used to run DLLs as if they were executables

vcbc & "\kikus.dll,GBSLWSDVGOE" is the command that is being executed
and GBSLWSDVGOE is the command-line arguments here

python oledump.py  Homelander.doc -s 19 --decompress -d > C:\Users\vboxuser\Desktop\dumpp.bin
This command will save the result in hex format to the "dumpp.bin" file.

<img width="760" alt="nrl1" src="https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/5ebdafe0-fdc0-44c9-b576-f9bced0443ad">

Opening the dump file in Hex Editor, As we clearly see the PE header in  our dumpp file... Extracting and saving this PE file from Hex Editor in our desktop

![h2](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/d91361b6-1b0a-48fd-9407-1aaf1a8486ed)

The file "InitialPayload.bin" is a 32bit dll file
![h3](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/e188cbda-8cf7-4abb-9ff0-84942a833e02)

with some irrelevant export sections

![h4](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/531edfc4-a0fb-4f4a-92e0-340151bfe979)

Now opeing this DLL with debugger

![h5](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/91b24f21-4f31-4f33-bd11-f1a8bdbee3fb)

Dump this DLL in x32dbg, File ... Open.. C:\Windows\SysWOW64 .... select rundll32.exe.. Change command line to... "C:\Windows\SysWOW64\rundll32.exe" "C:\Users\vboxuser\Desktop\InitialPayload.bin" GBSLWSDVGOE 
Refresh and Run until we see our module : InitialPayload.bin

![h6](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/35a812bd-210c-4fcb-beb8-3b13ccf2a566)

Now we will put some breakpoint

ret of the VirtualAlloc
VirtualProtect
ResumeThread
VirtualAllocEx

![h7](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/80def499-4ba6-44bd-ac90-ff6691286467)

Now we will run the sample
Dump the EAX and Run.. untill you find the payload (PE header)
We have the MZ header, dump that in desktop 

![h8](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/5cc17119-8a14-4b6d-afe9-110c3204e709)

Our 2nd Payload is too 32bit DLL

![h9](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/6bb19b85-5ae7-4577-8fd8-3a781cd027d2)

But in export section we can claerly see our suspicious passing parameter 

![h10](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/fbaeaa50-d444-4049-bd18-bb81ac994fb9)

Now opening this with Ghidra and going to export section ... GBSLWSDVGOE 

![h11](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/d79a225d-1d4b-45c1-8a13-2bfe05d02290)

Here we will check every function in the decompiler

1. FUN_10001390 : The API functions GetProcessHeap and HeapAlloc being used here to allocate a block of memory from the process heap.

   ![h12](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/e68fe902-659f-46ff-a236-0b8820c47d99)

2. FUN_10001aa0 : 
The function retrieves the Windows version using "GetVersion" and stores it in local_c
The code appears to be related to creating and sending some information, possibly in the form of a network request
GUID=%I64u&BUILD=%s&INFO=%s&EXT=%s&IP=%s&TYPE=1&WIN=%d.%d(x64)
The constructed string includes information like GUID, BUILD, INFO, EXT, IP, TYPE, and WIN. This kind of formatting is often seen in the context of constructing URLs or parameters for network requests, typically in the form of HTTP requests.

![h13](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/c7eb6831-4a7c-4ebc-8247-642edfd2bf6e)

3. FUN_10002cd0 :
This section will help you to understand how C2 details being extracted 

![h14](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/c23922ff-92bc-4621-aaca-8a4a0546b724)
![h15](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/4e9f71a9-6368-4e09-83ea-bfedb0977b6a)

We will check same in the debugger

Change the command line again ........ "C:\Windows\SysWOW64\rundll32.exe" "C:\Users\vboxuser\Desktop\2ndPayload.bin" GBSLWSDVGOE

Run couple of time, we will reach into our DLL

![h16](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/335213ab-109a-4286-b3d1-0f7f92e0bd92)

We will search for string references, we can see that suspicious string "GUID=%I64u&BUILD=%s&INFO=%s&EXT=%s&IP=%s&TYPE=1&WIN=%d.%d(x64)"

![h17](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/ec512f40-7a80-4b5a-b037-8c85461082e3)

and we can see the call "25B0" in both tools.. Will put breakpoint there and Run till we again get our 2nd payload DLL!!

![h18](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/0636b2ef-e2e0-4bc0-adda-efa73cfc7641)

We again got 25B0.. In Ghidra we saw that c2 collections inside 25BO inside 2CD0 function

![h19](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/3ee098a5-f20b-475f-ab56-b2c11b9c2dfe)

Using RC4 decryption in C2

![h20](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/d203e44a-021e-4af6-b6e4-f8475d0c774c)

So In debugger, we will do step into...... Here we have to look into 2CD0.... We will Breakpoint on 2CD0 and RUN.. and Dump the EAX

![h21](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/c3b3dfb5-3660-480e-9189-1e23268df5f5)

And we know it is a Decryption function and now if we do stepOut, we will see some data in the dump 

![h22](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/4bcb0994-8d15-4e0f-bf23-e84761e0ead7)

We can see the BotID and C2 details in the dump

These all are malicious links and realed to this malware

![h23](https://github.com/Dattatreyy/Chanitor-Malware/assets/107531426/c060e870-fa61-46f5-89b3-799849be80f6)
